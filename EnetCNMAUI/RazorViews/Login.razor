@using EnetCNMAUI.Authorization
@using EnetCNMAUI.Domain.Models
@inject ILocalCache LocalCache
@inject ICNApiService ApiService
@inject ILoginService loginService
@inject IThemeManager themeManager
@inject IJSRuntime JSRuntime
 


    <div class="d-flex flex-column">

    <!--\/header START\/-->
    <header class="nofoot fixed-top d-flex flex-wrap align-items-center justify-content-center justify-content-lg-between shadow py-lg-1">
      <div class="container d-flex flex-row justify-content-between">

        <!--\/LOGO START\/-->
        <a href="" class="logo d-none d-lg-block mb-2 mb-lg-0">
          <img src="img/logo-dark.svg" onerror="this.src='img/logo-dark.png'" alt="All About Local" style="height: 42px;" />
        </a> <!--/\LOGO END/\-->

        <!--\/DropDown Categories START\/-->
        <div class="btn-group d-none d-lg-none align-self-start ms-lg-4 ms-xl-5 mt-auto mb-1">
          <button class="btn btn-primary btn-sm dropdown-toggle rounded-3" type="button" data-bs-toggle="dropdown" aria-expanded="false">All Categories</button>
          <ul class="dropdown-menu">
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Wine &amp; Spirits <small class="badge text-bg-secondary rounded-pill p-1">14</small></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Eat &amp; Treat <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Health &amp; Fitness <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Automotive <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Shops <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Pets <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Beauty &amp; Spas <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Entertainment <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Kids <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Business Services <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Home <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">PERKS! <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">BOGO <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Dining <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
          </ul>
        </div> <!--/\DropDown Categories END/\-->

        <!--\/Navigation START\/-->
        <ul class="nav nav-foot d-flex flex-row flex-nowrap flex-lg-wrap justify-content-lg-end align-content-lg-between flex-lg-fill shadow mt-auto mt-lg-0">
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/directory.svg" alt="Directory" /> Directory</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/events.svg" alt="Events" class="me-lg-1" /> Events</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/favorites.svg" alt="Favorites" /> Favorites</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/map.svg" alt="Map" /> Map</a>
          </li>
          <!--\/More DropUp START\/-->
          <li class="d-none d-lg-none dropup">
            <a href="" class="nav-link text-decoration-none dropdown-toggle d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMore" aria-controls="offcanvasMore"> <img src="img/more.svg" alt="More" /> More</a>
            <div id="offcanvasMore" class="offcanvas offcanvas-bottom rounded-4 rounded-bottom-0" tabindex="-1">
              <div class="offcanvas-body shadow">
                <div class="list-group pt-2">
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Manage Subscription</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Get Full Access</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> My Savings</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Tips &amp; Help</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Membership</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Advertising</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Fundraising</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Where to Buy</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> About Us</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Privacy</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Notifications</a>
                  <div class="form-check form-switch list-group-item list-group-item-action mb-0 px-3" title="Switch between light and dark mode">
                    <label class="form-check-label d-flex column-gap-1 w-100" for="darkModeSwitch">
                      <i class="bi bi-moon-stars"></i>
                      Dark Mode 
                      <input id="darkModeSwitch" class="form-check-input ms-auto" type="checkbox" checked />
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </li> <!--/\More DropUp END/\-->
          <li class="d-none d-lg-block"><a href="login.html" class="nav-link px-2"> <i class="bi bi-person"></i> Login</a></li>
          <li class="d-none d-lg-flex mx-2"><a href="register.html" class="btn btn-primary btn-sm align-self-center rounded-3 px-3">Create Account</a></li>
          <li class="d-none d-lg-block ms-2 me-1">
            <input id="darkModeButton" type="checkbox" class="btn-check" checked />
            <label class="btn btn-dark" for="darkModeButton"></label>
          </li>
          <li class="d-none d-lg-none w-100"></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Membership</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Advertising</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Fundraising</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Where to Buy</a></li>
        </ul> <!--/\Navigation END/\-->

      </div> <!--/\.container/\-->
      <!--\/Mobile TOP START\/-->
      <div id="mob_top" class="d-none d-lg-none flex-row flex-nowrap justify-content-between align-items-center text-light lh-1 w-100 shadow">
        <a href="" class="d-flex fs-5 link-light ms-1 me-3 p-2"> <i class="bi bi-chevron-left"></i> </a>
        <div class="d-none fs-4 text-center text-truncate lh-lg me-auto">Account Login</div>
        <div class="d-none">
          <a href="" class="link-light mx-1 p-3" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSearch" aria-controls="offcanvasSearch"> <i class="bi bi-search"></i> </a>
          <div id="offcanvasSearch" class="offcanvas offcanvas-top" tabindex="-1">
            <div class="offcanvas-body p-2 px-1">
              <button type="button" class="btn-close position-absolute end-0 p-3" data-bs-dismiss="offcanvas" aria-label="Close"></button>
             
            </div>
          </div>
        </div>
      </div> <!--/\Mobile TOP END/\-->
    </header> <!--/\header END/\-->
 
    <!--\/main content START\/-->
    <main class="flex-shrink-0 mb-0">
      <div class="container-fluid">

        <div class="row justify-content-center">
          <div class="col-lg-5 d-none d-lg-block vh-100 bg-no-repeat bg-size-cover bg-position-center p-0" style="background-image:url('img/login-bg.jpg');"></div>
          <div class="col-lg-7 d-flex align-items-center vh-100">
            <div class="card shadow-none border-0 ms-auto me-auto login-card">
              <div class="card-body text-left pt-0">
                <h3 class="login d-block d-lg-block">Account Login</h3>
                  <EditForm EditContext="_editContext" OnValidSubmit="SubmitForm">
                        <FluentValidationValidator />
 
                <!-- <h6 class="text-center text-body-emphasis fs-6">Some Heading</h6> -->
                <!-- <small class="d-block mb-3">Welcome back! Sign in to your account.</small> -->
                  <div class="form-floating mb-3">
                      <InputText @bind-Value="_login.UserName" type="tel" id="phone" class="form-control" placeholder="Your Phone" />
                       <ValidationMessage For="@(() => _login.UserName)" />
                    <label for="username">Your Phone:</label>
                  </div>
                  <div class="form-floating position-relative mb-3">
                     <InputText @bind-Value="_login.Password" type="Password" class="form-control" placeholder="Password:" />
                      <ValidationMessage For="@(() => _login.Password)" />
                    <label for="password">Password:</label>
                    <i class="bi bi-eye pe-5" id="togglePassword"></i>
                  </div>
                  <div class="d-flex justify-content-between align-items-center ps-0">
                    <a href="forgot-password.html" class="">Forgot Password?</a>
                    <button class="btn btn-secondary ms-auto px-4 py-3" name="submit" type="submit">LOGIN</button>
                  </div>
                 <small class="d-flex justify-content-center align-items-center gap-3 bg-gray text-body-emphasis rounded-2 mt-5 mb-3 py-2">Don't have account? <a @onclick="OpenRegistrationPage" href="register.html" class="btn btn-sm btn-light text-black-50 d-inline-block rounded-pill" role="button">Sign Up Here</a></small>

                <!-- <hr /> -->
                <!-- <small class="d-block text-center mt-2 mb-1 p-0">Or, Sign in with your social account </small> -->
                <!-- <p class="d-flex justify-content-evenly mb-0"> -->
                  <!-- <a href="" class="btn btn-sm btn-google"><i class="bi bi-google"></i> Google</a> -->
                  <!-- <a href="" class="btn btn-sm btn-facebook"><i class="bi bi-facebook"></i> Facebook</a> -->
                <!-- </p> -->
                </EditForm>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main> <!--/\main content END/\-->

    
 
  </div>

  @* <ErrorBoundary>
    <ChildContent>
         <div class="d-flex flex-column">

    <!--\/header START\/-->
    <header class="fixed-top d-flex flex-wrap align-items-center justify-content-center justify-content-lg-between shadow py-lg-1">
      <div class="container d-flex flex-row justify-content-between">

        <!--\/LOGO START\/-->
        <a href="" class="logo d-none d-lg-block mb-2 mb-lg-0">
          <img src="img/logo-dark.svg" onerror="this.src='img/logo-dark.png'" alt="All About Local" style="height: 42px;" />
        </a> <!--/\LOGO END/\-->

        <!--\/DropDown Categories START\/-->
        <div class="btn-group d-none d-lg-none align-self-start ms-lg-4 ms-xl-5 mt-auto mb-1">
          <button class="btn btn-primary btn-sm dropdown-toggle rounded-3" type="button" data-bs-toggle="dropdown" aria-expanded="false">All Categories</button>
          <ul class="dropdown-menu">
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Wine &amp; Spirits <small class="badge text-bg-secondary rounded-pill p-1">14</small></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Eat &amp; Treat <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Health &amp; Fitness <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Automotive <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Shops <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Pets <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Beauty &amp; Spas <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Entertainment <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Kids <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Business Services <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Home <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">PERKS! <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">BOGO <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
            <li><a href="" class="dropdown-item d-flex justify-content-between align-items-baseline px-2">Dining <span class="badge text-bg-secondary rounded-pill p-1">4</span></a></li>
          </ul>
        </div> <!--/\DropDown Categories END/\-->

        <!--\/Navigation START\/-->
        <ul class="nav nav-foot d-flex flex-row flex-nowrap flex-lg-wrap justify-content-lg-end align-content-lg-between flex-lg-fill shadow mt-auto mt-lg-0">
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/directory.svg" alt="Directory" /> Directory</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/events.svg" alt="Events" class="me-lg-1" /> Events</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/favorites.svg" alt="Favorites" /> Favorites</a>
          </li>
          <li class="d-none d-lg-none">
            <a href="" class="nav-link d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2"> <img src="img/map.svg" alt="Map" /> Map</a>
          </li>
          <!--\/More DropUp START\/-->
          <li class="d-none d-lg-none dropup">
            <a href="" class="nav-link text-decoration-none dropdown-toggle d-flex flex-column flex-lg-row justify-content-between align-items-center column-gap-1 pb-1 pb-lg-2 px-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMore" aria-controls="offcanvasMore"> <img src="img/more.svg" alt="More" /> More</a>
            <div id="offcanvasMore" class="offcanvas offcanvas-bottom rounded-4 rounded-bottom-0" tabindex="-1">
              <div class="offcanvas-body shadow">
                <div class="list-group pt-2">
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Manage Subscription</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Get Full Access</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> My Savings</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Tips &amp; Help</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Membership</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Advertising</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Local Fundraising</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Where to Buy</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> About Us</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Privacy</a>
                  <a href="" class="list-group-item list-group-item-action"><i class="bi bi-chevron-right"></i> Notifications</a>
                  <div class="form-check form-switch list-group-item list-group-item-action mb-0 px-3" title="Switch between light and dark mode">
                    <label class="form-check-label d-flex column-gap-1 w-100" for="darkModeSwitch">
                      <i class="bi bi-moon-stars"></i>
                      Dark Mode 
                      <input id="darkModeSwitch" class="form-check-input ms-auto" type="checkbox" checked />
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </li> <!--/\More DropUp END/\-->
          <li class="d-none d-lg-block"><a href="login.html" class="nav-link px-2"> <i class="bi bi-person"></i> Login</a></li>
          <li class="d-none d-lg-flex mx-2"><a href="register.html" class="btn btn-primary btn-sm align-self-center rounded-3 px-3">Create Account</a></li>
          <li class="d-none d-lg-block ms-2 me-1">
            <input id="darkModeButton" type="checkbox" class="btn-check" checked />
            <label class="btn btn-dark" for="darkModeButton"></label>
          </li>
          <li class="d-none d-lg-none w-100"></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Membership</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Advertising</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Local Fundraising</a></li>
          <li class="d-none d-lg-none"><a href="" class="nav-link px-2">Where to Buy</a></li>
        </ul> <!--/\Navigation END/\-->

      </div> <!--/\.container/\-->
      <!--\/Mobile TOP START\/-->
      <div id="mob_top" class="d-flex d-lg-none flex-row flex-nowrap justify-content-between align-items-center text-light lh-1 w-100 shadow">
        <a href="" class="d-flex fs-5 link-light ms-1 me-3 p-2"> <i class="bi bi-chevron-left"></i> </a>
        <div class="d-none fs-4 text-center text-truncate lh-lg me-auto">Account Login</div>
        <div class="d-none">
          <a href="" class="link-light mx-1 p-3" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSearch" aria-controls="offcanvasSearch"> <i class="bi bi-search"></i> </a>
          <div id="offcanvasSearch" class="offcanvas offcanvas-top" tabindex="-1">
            <div class="offcanvas-body p-2 px-1">
              <button type="button" class="btn-close position-absolute end-0 p-3" data-bs-dismiss="offcanvas" aria-label="Close"></button>
             
            </div>
          </div>
        </div>
      </div> <!--/\Mobile TOP END/\-->
    </header> <!--/\header END/\-->
 
    <!--\/main content START\/-->
    <main class="flex-shrink-0 mb-0">
      <div class="container-fluid">

        <div class="row justify-content-center">
          <div class="col-lg-5 d-none d-lg-block vh-100 bg-no-repeat bg-size-cover bg-position-center p-0" style="background-image:url('img/login-bg.jpg');"></div>
          <div class="col-lg-7 d-flex align-items-center vh-100">
            <div class="card shadow-none border-0 ms-auto me-auto login-card">
              <div class="card-body text-left pt-0">
                <h3 class="login d-block d-lg-block">Account Login</h3>
                  <EditForm EditContext="_editContext" OnValidSubmit="SubmitForm">
                        <FluentValidationValidator />
 
                <!-- <h6 class="text-center text-body-emphasis fs-6">Some Heading</h6> -->
                <!-- <small class="d-block mb-3">Welcome back! Sign in to your account.</small> -->
                  <div class="form-floating mb-3">
                      <InputText @bind-Value="_login.UserName" type="tel" id="phone" class="form-control" placeholder="Your Phone" />
                       <ValidationMessage For="@(() => _login.UserName)" />
                    <label for="username">Your Phone:</label>
                  </div>
                  <div class="form-floating position-relative mb-3">
                     <InputText @bind-Value="_login.Password" type="Password" class="form-control" placeholder="Password:" />
                      <ValidationMessage For="@(() => _login.Password)" />
                    <label for="password">Password:</label>
                    <i class="bi bi-eye pe-5" id="togglePassword"></i>
                  </div>
                  <div class="d-flex justify-content-between align-items-center ps-0">
                    <a href="forgot-password.html" class="">Forgot Password?</a>
                    <button class="btn btn-secondary ms-auto px-4 py-3" name="submit" type="submit">LOGIN</button>
                  </div>
                 <small class="d-flex justify-content-center align-items-center gap-3 bg-gray text-body-emphasis rounded-2 mt-5 mb-3 py-2">Don't have account? <a @onclick="OpenRegistrationPage" href="register.html" class="btn btn-sm btn-light text-black-50 d-inline-block rounded-pill" role="button">Sign Up Here</a></small>

                <!-- <hr /> -->
                <!-- <small class="d-block text-center mt-2 mb-1 p-0">Or, Sign in with your social account </small> -->
                <!-- <p class="d-flex justify-content-evenly mb-0"> -->
                  <!-- <a href="" class="btn btn-sm btn-google"><i class="bi bi-google"></i> Google</a> -->
                  <!-- <a href="" class="btn btn-sm btn-facebook"><i class="bi bi-facebook"></i> Facebook</a> -->
                <!-- </p> -->
                </EditForm>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main> <!--/\main content END/\-->

    
 
  </div>
   </ChildContent>
    <ErrorContent>
       <div>Error Occured</div>
    </ErrorContent>
</ErrorBoundary>
 *@

@code {

    private EditContext _editContext = default!;

    private LoginModel _login = new LoginModel();
    private IJSObjectReference? loginJsRefernce;
    private DotNetObjectReference<Login>? loginDotnetReference;


    protected override async void OnInitialized()
    {
        //loginDotnetReference = DotNetObjectReference.Create(this);
        //loginJsRefernce = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./RazorViews/Login.razor.js");
        _editContext = new EditContext(_login);
        _editContext.SetFieldCssClassProvider(new BootstrapCssClassProvider());
        loginJsRefernce = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./RazorViews/Login.razor.js");
        themeManager.Register(this, JSRuntime);
        var theme = Preferences.Get(StringConstants.UserTheme, null);
        // If the theme is null, pass AppTheme.Unspecified, otherwise pass dark or light theme.
        themeManager.UpdateAppTheme(
            string.IsNullOrEmpty(theme) ? AppTheme.Unspecified : (theme == "dark" ? AppTheme.Dark : AppTheme.Light)
        );
        await loginJsRefernce.InvokeVoidAsync("setPasswordViewToggle");
    }

    private string _username = "";

    private string _password = "";

    private async void ContinueWithGoolge()
    {
        await loginService.Login();
    }


    private async Task SubmitForm()
    {
        //loginfailed = false;
        try
        {
            var inputType = _login.UserName.GetInputType();
            if (inputType == UsernameInputType.Invalid)
            {
                return;
            }
            var loginRequest = new LoginRequest.Builder()
           .SetPhone(inputType == UsernameInputType.PhoneNumber? _login.UserName : string.Empty)
           .SetPassword(_login.Password)
           .Build();

            var result = await ApiService.Login(loginRequest);
            if (result.Success && result.Data!=null)
            {
                Preferences.Default.Set(StringConstants.IsUserLoggedIn, true);

                await LocalCache.SaveItemInCache<AALUser>(StringConstants.CurrentUser, result.Data);
                var sggg  = await LocalCache.GetCacheItem<AALUser>(StringConstants.CurrentUser);

                Preferences.Default.Set(StringConstants.CurrentUserKey, result.Data.UserKey.ToString());

                await GetSubscription(result.Data.UserKey);
                 await Shell.Current.GoToAsync("//HomePage");
            }
            else
            {
                await App.Current.MainPage.DisplayAlert("Login Failed", result.Message ?? "An error occurred during login.", "OK");
                // loginfailed = true;
            }
            //GotoHomePage();
        }
        catch (Exception ex)
        {
            // loginfailed = true;
            Console.WriteLine($"{ex.Message}");
        }
    }
    private async Task GetSubscription(int userKey)
    {
        try
        {
            var businessMapRequest = new UserSubscriptionPlanRequest(userKey);
            var output = await ApiService.AppUsersActiveSubscription(businessMapRequest);
            if (output.Success && output.Data != null && output.Data.Count > 0)
            {
                App.PlanDetails = output.Data[0];
                await LocalCache.SaveItemInCache<PlanDetails>(LocalCacheKeys.PlanDetails, output.Data[0]);
                Preferences.Default.Set(StringConstants.IsPlanActive, output.Data[0].IsActive);
            }
        }
        catch (Exception ex)
        {

        }

    }

    public async void OpenRegistrationPage()
    {
        await Shell.Current.GoToAsync("RegistrationByPhonePage");
    }

    public async void GotoHomePage()
    {
      
        await Shell.Current.GoToAsync("//FeedPage");
    }
    public async void GotoForgotPassword()
    {
        //Shell.Current.FlyoutIsPresented = true;
        await Shell.Current.GoToAsync("ForgotPasswordPage");
    }
}

